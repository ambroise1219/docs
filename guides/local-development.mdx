# Local Development

Ce guide vous aidera √† configurer un environnement de d√©veloppement local pour l'API ONO Backend.

## üõ†Ô∏è Pr√©requis

Avant de commencer, assurez-vous d'avoir install√© les outils suivants :

- Rust (√©dition 2021 ou sup√©rieure) - https://www.rust-lang.org/
- PostgreSQL (version 13 ou sup√©rieure) - https://www.postgresql.org/
- Redis - https://redis.io/
- Node.js (pour les outils de d√©veloppement) - https://nodejs.org/

## üì¶ Installation

### 1. Cloner le d√©p√¥t

```bash
git clone https://github.com/ono/ono-backend.git
cd ono-backend
```

### 2. Installer les d√©pendances Rust

```bash
cargo build
```

Cette commande t√©l√©chargera et compilera toutes les d√©pendances du projet.

### 3. Configurer les bases de donn√©es

Cr√©ez les bases de donn√©es n√©cessaires dans PostgreSQL :

```sql
CREATE DATABASE ono_main;
CREATE DATABASE ono_food;
CREATE DATABASE ono_delivery;
CREATE DATABASE ono_social;
CREATE DATABASE ono_medical;
```

### 4. Configurer les variables d'environnement

Copiez le fichier d'exemple et configurez vos variables :

```bash
cp .env.example .env
```

√âditez le fichier `.env` avec vos configurations :

```env
# Configuration de base
ENVIRONMENT=development
JWT_SECRET=your-super-secret-jwt-key-change-in-production

# Bases de donn√©es
ONO_MAIN_DATABASE_URL=postgresql://user:password@localhost:5432/ono_main
ONO_FOOD_DATABASE_URL=postgresql://user:password@localhost:5432/ono_food
ONO_DELIVERY_DATABASE_URL=postgresql://user:password@localhost:5432/ono_delivery
ONO_MEDICAL_DATABASE_URL=postgresql://user:password@localhost:5432/ono_medical
DATABASE_URL=postgresql://user:password@localhost:5432/ono_main

# Redis
REDIS_URL=redis://127.0.0.1:6379

# Configuration OTP/Wanotifier
WANOTIFIER_API_KEY=your-wanotifier-api-key
WANOTIFIER_API_URL=https://api.wanotifier.com/v1
OTP_EXPIRATION_MINUTES=5
OTP_MAX_ATTEMPTS=3
```

### 5. Ex√©cuter les migrations

Les migrations doivent √™tre ex√©cut√©es pour chaque base de donn√©es :

```bash
# Ex√©cuter les migrations principales
sqlx migrate run --database-url postgresql://user:password@localhost:5432/ono_main

# Ex√©cuter les migrations food
sqlx migrate run --database-url postgresql://user:password@localhost:5432/ono_food

# Ex√©cuter les migrations delivery
sqlx migrate run --database-url postgresql://user:password@localhost:5432/ono_delivery
```

Ou utilisez le script de migration int√©gr√© :

```bash
cargo run --bin run-migrations
```

### 6. D√©marrer les services requis

D√©marrez Redis :

```bash
redis-server
```

### 7. D√©marrer le serveur de d√©veloppement

```bash
cargo run
```

Le serveur d√©marrera sur http://localhost:3000.

## üß™ Tests

### Ex√©cuter tous les tests

```bash
cargo test
```

### Ex√©cuter les tests sp√©cifiques √† un module

```bash
cargo test food
cargo test delivery
```

### Ex√©cuter les tests d'int√©gration

```bash
./tests/test_all_food_endpoints.sh
./tests/test_user_crud.sh
```

## üê≥ D√©veloppement avec Docker (Optionnel)

Si vous pr√©f√©rez utiliser Docker pour votre environnement de d√©veloppement :

### 1. D√©marrer les services avec Docker Compose

```bash
docker-compose up -d
```

### 2. Ex√©cuter les migrations

```bash
docker-compose exec app cargo run --bin run-migrations
```

### 3. D√©marrer le serveur

```bash
docker-compose exec app cargo run
```

## üîß Outils de d√©veloppement utiles

### Formatage du code

```bash
cargo fmt
```

### V√©rification du code

```bash
cargo clippy
```

### G√©n√©ration de la documentation

```bash
cargo doc --open
```

## üåê Acc√®s aux services

Une fois le serveur d√©marr√©, vous pouvez acc√©der aux services suivants :

- **API principale** : http://localhost:3000
- **Documentation Swagger** : http://localhost:3000/swagger-ui
- **Serveur gRPC Pulse** : http://localhost:50051
- **Documentation Mintlify** : http://localhost:3001 (si d√©marr√© s√©par√©ment)

## üî´ D√©pannage

### Probl√®mes de compilation

Si vous rencontrez des probl√®mes de compilation, essayez :

```bash
cargo clean
cargo build
```

### Probl√®mes de base de donn√©es

V√©rifiez que vos bases de donn√©es sont accessibles :

```bash
psql postgresql://user:password@localhost:5432/ono_main -c "SELECT 1;"
```

### Probl√®mes de d√©pendances

Mettez √† jour les d√©pendances :

```bash
cargo update
```