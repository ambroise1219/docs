# Food API

<Note>
  **Production Ready** - Plateforme compl√®te de commande de nourriture avec restaurants, plats, promotions, stocks, employ√©s et avis
</Note>

L'API Food permet de g√©rer une plateforme compl√®te de commande de nourriture avec restaurants, menus, suppl√©ments, commandes, promotions, gestion des stocks, employ√©s, avis et favoris.

## üöÄ Quick Start

<Steps>
  <Step title="Cr√©er un restaurant">
    Inscription restaurateur avec d√©tails complets
  </Step>
  <Step title="Ajouter le menu">
    Cat√©gories, plats, suppl√©ments
  </Step>
  <Step title="G√©rer les stocks">
    Suivi des quantit√©s en temps r√©el
  </Step>
  <Step title="Ajouter des employ√©s">
    Manager, caissier, cuisinier, serveur
  </Step>
  <Step title="G√©rer les commandes">
    R√©ception et traitement des commandes
  </Step>
  <Step title="Livraison">
    Int√©gration avec le module Delivery
  </Step>
</Steps>

## üì¶ Modules

<CardGroup cols={3}>
  <Card title="Restaurants" icon="store">
    Gestion restaurants
    - Profil complet
    - Horaires d'ouverture
    - Zone de livraison
    - Actions admin (activer/suspendre)
  </Card>
  
  <Card title="Menu" icon="utensils">
    Gestion du menu
    - Cat√©gories de plats
    - Plats avec nutrition
    - Suppl√©ments
    - Personnalisation
  </Card>
  
  <Card title="Stocks" icon="boxes-stacked">
    Gestion des stocks
    - Stock temps r√©el
    - Alertes stock bas
    - Historique mouvements
    - R√©initialisation quotidienne
  </Card>
  
  <Card title="Employ√©s" icon="users">
    Gestion du personnel
    - 5 r√¥les (manager, caissier, etc.)
    - 12 permissions granulaires
    - Historique des actions
  </Card>
  
  <Card title="Horaires" icon="clock">
    Horaires avanc√©s
    - Exceptions (jours f√©ri√©s)
    - Pauses journali√®res
    - Cr√©neaux de livraison
  </Card>
  
  <Card title="Menus Programm√©s" icon="calendar">
    Menus du jour/semaine
    - Menu quotidien
    - Menu hebdomadaire
    - Disponibilit√© par cr√©neau
  </Card>
  
  <Card title="Commandes" icon="shopping-cart">
    Gestion des commandes
    - Panier avec suppl√©ments
    - Codes promo
    - Suivi en temps r√©el
    - Int√©gration livraison
  </Card>
  
  <Card title="Promotions" icon="tag">
    Codes promo
    - Pourcentage ou montant fixe
    - Livraison gratuite
    - Limites d'utilisation
  </Card>
</CardGroup>

---

## üì° Endpoints API Complets

### üè™ Restaurants

#### Routes Publiques

```bash
# Lister tous les restaurants
GET /api/food/restaurants
# Query params: city, search, cuisine_types, page, per_page

# Restaurants ouverts maintenant
GET /api/food/restaurants/status/open-now

# Restaurants actifs
GET /api/food/restaurants/active

# Restaurants en attente (admin)
GET /api/food/restaurants/pending

# Restaurants ferm√©s
GET /api/food/restaurants/closed

# Restaurants suspendus (admin)
GET /api/food/restaurants/suspended

# Restaurants populaires (cached)
GET /api/food/restaurants/popular

# R√©cup√©rer par ID
GET /api/food/restaurants/{id}

# R√©cup√©rer par slug
GET /api/food/restaurants/slug/{slug}
```

#### Routes Prot√©g√©es (Owner/Admin)

```bash
# Cr√©er restaurant (JSON)
POST /api/food/restaurants

# Cr√©er restaurant (Multipart avec images)
POST /api/food/restaurants/multipart

# Mes restaurants
GET /api/food/restaurants/owner/me

# Modifier restaurant
PUT /api/food/restaurants/{id}

# Modifier restaurant (Multipart)
PUT /api/food/restaurants/{id}/multipart

# Supprimer restaurant
DELETE /api/food/restaurants/{id}

# Stats du restaurant
GET /api/food/restaurants/{id}/stats
```

#### Actions Admin

```bash
# Activer un restaurant (Pending ‚Üí Active)
POST /api/food/restaurants/{id}/activate

# Suspendre un restaurant
POST /api/food/restaurants/{id}/suspend
# Body: {"reason": "Violation des conditions"}

# R√©activer un restaurant suspendu
POST /api/food/restaurants/{id}/unsuspend

# Fermer d√©finitivement
POST /api/food/restaurants/{id}/close
```

---

### üìÇ Cat√©gories de Plats

```bash
# Lister cat√©gories d'un restaurant
GET /api/food/restaurants/{restaurant_id}/categories

# R√©cup√©rer une cat√©gorie
GET /api/food/categories/{id}

# Cr√©er cat√©gorie (Multipart)
POST /api/food/restaurants/{restaurant_id}/categories
# Form: name, description, sort_order, image (file)

# Modifier cat√©gorie
PUT /api/food/restaurants/{restaurant_id}/categories/{id}

# Supprimer cat√©gorie
DELETE /api/food/restaurants/{restaurant_id}/categories/{id}
```

---

### üçΩÔ∏è Plats / Menu

```bash
# Lister plats d'un restaurant
GET /api/food/restaurants/{restaurant_id}/dishes

# Lister plats d'une cat√©gorie
GET /api/food/categories/{category_id}/dishes

# Plats populaires (cached)
GET /api/food/dishes/popular

# R√©cup√©rer un plat
GET /api/food/dishes/{id}

# Cr√©er plat (Multipart)
POST /api/food/restaurants/{restaurant_id}/dishes
# Form: name, description, base_price, category_id, image (file)

# Modifier plat
PUT /api/food/restaurants/{restaurant_id}/dishes/{id}

# Supprimer plat
DELETE /api/food/restaurants/{restaurant_id}/dishes/{id}
```

---

### üßÇ Cat√©gories de Suppl√©ments

```bash
# Lister cat√©gories de suppl√©ments
GET /api/food/restaurants/{restaurant_id}/supplement-categories

# R√©cup√©rer une cat√©gorie
GET /api/food/supplement-categories/{id}

# Cr√©er cat√©gorie (Multipart)
POST /api/food/restaurants/{restaurant_id}/supplement-categories
# Form: name, description, is_required, min_selection, max_selection

# Modifier cat√©gorie
PUT /api/food/restaurants/{restaurant_id}/supplement-categories/{id}

# Supprimer cat√©gorie
DELETE /api/food/restaurants/{restaurant_id}/supplement-categories/{id}
```

---

### ü•§ Suppl√©ments

```bash
# Lister suppl√©ments d'un restaurant
GET /api/food/restaurants/{restaurant_id}/supplements

# Lister suppl√©ments d'une cat√©gorie
GET /api/food/supplement-categories/{category_id}/supplements

# R√©cup√©rer un suppl√©ment
GET /api/food/supplements/{id}

# Cr√©er suppl√©ment (Multipart)
POST /api/food/restaurants/{restaurant_id}/supplements
# Form: name, price, category_id, is_available, image (file)

# Modifier suppl√©ment
PUT /api/food/restaurants/{restaurant_id}/supplements/{id}

# Supprimer suppl√©ment
DELETE /api/food/restaurants/{restaurant_id}/supplements/{id}
```

---

### üì¶ Gestion des Stocks

<Note>
  **Nouveau !** Syst√®me complet de gestion des stocks avec alertes et historique
</Note>

```bash
# R√©sum√© du stock (dashboard)
GET /api/food/restaurants/{restaurant_id}/stock
# Response: total_dishes, dishes_in_stock, dishes_low_stock, dishes_out_of_stock, alerts

# Liste compl√®te des stocks (plats + suppl√©ments)
GET /api/food/restaurants/{restaurant_id}/stock/all

# Alertes stock bas
GET /api/food/restaurants/{restaurant_id}/stock/alerts

# Historique des mouvements
GET /api/food/restaurants/{restaurant_id}/stock/history
# Query: item_id (optional), limit (default: 50)

# R√©initialisation quotidienne
POST /api/food/restaurants/{restaurant_id}/stock/reset
# Body: {"reset_all": true} ou {"dish_ids": ["uuid1", "uuid2"]}
```

#### Stock par Plat

```bash
# R√©cup√©rer stock d'un plat
GET /api/food/restaurants/{restaurant_id}/dishes/{dish_id}/stock

# D√©finir le stock
PUT /api/food/restaurants/{restaurant_id}/dishes/{dish_id}/stock
# Body: {"quantity": 50, "reason": "R√©approvisionnement"}

# Ajuster le stock (+/-)
POST /api/food/restaurants/{restaurant_id}/dishes/{dish_id}/stock/adjust
# Body: {"adjustment": -5, "reason": "Perte/casse"}
```

#### Stock par Suppl√©ment

```bash
# R√©cup√©rer stock d'un suppl√©ment
GET /api/food/restaurants/{restaurant_id}/supplements/{supplement_id}/stock
```

#### R√©ponse Stock

```json
{
  "success": true,
  "data": {
    "item_type": "dish",
    "item_id": "uuid",
    "item_name": "Attieke Poisson",
    "current_quantity": 25,
    "max_daily_quantity": 50,
    "is_available": true,
    "stock_percentage": 50.0,
    "status": "IN_STOCK"  // UNLIMITED, IN_STOCK, LOW_STOCK, OUT_OF_STOCK, UNAVAILABLE
  }
}
```

---

### üë• Gestion des Employ√©s

<Note>
  **Nouveau !** Syst√®me complet de gestion du personnel avec r√¥les et permissions
</Note>

#### R√¥les Disponibles

| R√¥le | Description |
|------|-------------|
| `manager` | Acc√®s complet √† toutes les fonctionnalit√©s |
| `cashier` | Gestion des commandes et paiements |
| `cook` | Visualisation des commandes et stocks |
| `waiter` | Gestion des commandes |
| `delivery_prep` | Pr√©paration des commandes pour livraison |

#### Permissions

```
view_orders, manage_orders, view_menu, manage_menu,
view_stock, manage_stock, view_employees, manage_employees,
view_stats, manage_promotions, process_payments, manage_settings
```

#### Endpoints

```bash
# Lister r√¥les et permissions disponibles
GET /api/food/restaurants/{restaurant_id}/employees/roles

# Lister employ√©s
GET /api/food/restaurants/{restaurant_id}/employees
# Query: active_only=true (optionnel)

# Mon profil employ√©
GET /api/food/restaurants/{restaurant_id}/employees/me

# Cr√©er employ√©
POST /api/food/restaurants/{restaurant_id}/employees
# Body: {"user_id": "uuid", "role": "cook", "permissions": ["view_orders", "view_stock"]}

# R√©cup√©rer employ√©
GET /api/food/restaurants/{restaurant_id}/employees/{employee_id}

# Modifier employ√©
PUT /api/food/restaurants/{restaurant_id}/employees/{employee_id}
# Body: {"role": "waiter", "permissions": [...], "is_active": true}

# D√©sactiver employ√© (soft delete)
POST /api/food/restaurants/{restaurant_id}/employees/{employee_id}/terminate

# Supprimer employ√© (hard delete)
DELETE /api/food/restaurants/{restaurant_id}/employees/{employee_id}

# Historique des actions
GET /api/food/restaurants/{restaurant_id}/employees/logs
# Query: employee_id (optional), limit (default: 50)
```

#### Exemple Cr√©ation Employ√©

```json
// POST /api/food/restaurants/{id}/employees
{
  "user_id": "23f6f108-b7ff-4ca1-8ea3-985b6e6cf96a",
  "role": "cook",
  "permissions": ["view_orders", "view_menu", "view_stock", "manage_stock"]
}

// Response
{
  "success": true,
  "data": {
    "id": "d40208bf-e7de-4240-aec7-c525488e6103",
    "restaurant_id": "19c247e0-ec76-46e0-9f70-1d3f8227f90e",
    "user_id": "23f6f108-b7ff-4ca1-8ea3-985b6e6cf96a",
    "role": "cook",
    "permissions": ["view_orders", "view_menu", "view_stock", "manage_stock"],
    "is_active": true,
    "hired_at": "2025-12-01T14:09:39.465692Z",
    "terminated_at": null
  }
}
```

---

### üõí Commandes

```bash
# Cr√©er commande
POST /api/food/restaurants/{restaurant_id}/orders

# Mes commandes (client)
GET /api/food/orders/me

# Commandes du restaurant (owner)
GET /api/food/restaurants/{restaurant_id}/orders

# D√©tails commande
GET /api/food/orders/{id}

# Mettre √† jour statut
PUT /api/food/orders/{id}/status
# Body: {"status": "preparing"}

# Suivi livraison
GET /api/food/orders/{id}/delivery-tracking

# Demander livraison
POST /api/food/orders/{id}/request-delivery
```

#### Statuts de Commande

```
pending ‚Üí confirmed ‚Üí preparing ‚Üí ready ‚Üí out_for_delivery ‚Üí delivered
                                       ‚Üò cancelled
```

#### Exemple Cr√©ation Commande

```json
// POST /api/food/restaurants/{id}/orders
{
  "items": [
    {
      "dish_id": "uuid",
      "quantity": 2,
      "supplement_ids": ["uuid1", "uuid2"],
      "special_instructions": "Sans oignon"
    }
  ],
  "delivery_address": "Cocody Riviera, Rue des Jardins",
  "delivery_lat": 5.35,
  "delivery_lng": -3.99,
  "delivery_contact": "+2250700000000",
  "payment_method": "mobile_money",
  "promo_code": "PROMO10"
}
```

---

### üè∑Ô∏è Promotions

```bash
# Cr√©er promotion (owner)
POST /api/food/restaurants/{restaurant_id}/promotions

# Lister promotions du restaurant
GET /api/food/restaurants/{restaurant_id}/promotions

# Promotions actives (public)
GET /api/food/promotions/active/{restaurant_id}

# R√©cup√©rer promotion
GET /api/food/restaurants/{restaurant_id}/promotions/{promotion_id}

# Modifier promotion
PUT /api/food/restaurants/{restaurant_id}/promotions/{promotion_id}

# D√©sactiver promotion
POST /api/food/restaurants/{restaurant_id}/promotions/{promotion_id}/deactivate

# Valider code promo (client)
POST /api/food/promotions/validate
# Body: {"code": "PROMO10", "restaurant_id": "uuid", "order_subtotal": 15000}
```

#### Types de R√©duction

| Type | Description |
|------|-------------|
| `PERCENTAGE` | Pourcentage de r√©duction (ex: 10%) |
| `FIXED_AMOUNT` | Montant fixe (ex: 1000 FCFA) |
| `FREE_DELIVERY` | Livraison gratuite |

#### Exemple Cr√©ation Promotion

```json
// POST /api/food/restaurants/{id}/promotions
{
  "code": "NOEL2025",
  "name": "Promo No√´l",
  "description": "20% de r√©duction pour No√´l",
  "discount_type": "PERCENTAGE",
  "discount_value": 20.0,
  "min_order_amount": 5000.0,
  "max_discount_amount": 3000.0,
  "starts_at": "2025-12-20T00:00:00Z",
  "ends_at": "2025-12-31T23:59:59Z",
  "max_uses": 500,
  "is_active": true
}
```

---

### ‚≠ê Avis / Reviews

```bash
# Cr√©er avis restaurant
POST /api/food/restaurants/{restaurant_id}/reviews
# Body: {"rating": 5, "comment": "Excellent !"}

# Lister avis restaurant
GET /api/food/restaurants/{restaurant_id}/reviews

# Cr√©er avis plat
POST /api/food/dishes/{dish_id}/reviews

# Lister avis plat
GET /api/food/dishes/{dish_id}/reviews
```

---

### ‚ù§Ô∏è Favoris

```bash
# Ajouter restaurant aux favoris
POST /api/food/restaurants/{restaurant_id}/favorite

# Retirer des favoris
DELETE /api/food/restaurants/{restaurant_id}/favorite

# Mes restaurants favoris
GET /api/food/favorites/restaurants

# Ajouter plat aux favoris
POST /api/food/dishes/{dish_id}/favorite

# Retirer des favoris
DELETE /api/food/dishes/{dish_id}/favorite

# Mes plats favoris
GET /api/food/favorites/dishes
```

---

### üìä Statistiques

```bash
# Stats globales syst√®me (admin only)
GET /api/food/stats

# Stats d'un restaurant (owner/admin)
GET /api/food/restaurants/{id}/stats
```

#### R√©ponse Stats Restaurant

```json
{
  "success": true,
  "data": {
    "total_orders": 1250,
    "total_revenue": 15750000,
    "average_order_value": 12600,
    "total_dishes": 45,
    "total_reviews": 320,
    "average_rating": 4.7,
    "orders_by_status": {
      "delivered": 1100,
      "cancelled": 50,
      "pending": 100
    }
  }
}
```

---


---

### üìÖ Horaires Avanc√©s (Schedule)

<Note>
  **Nouveau !** Gestion des horaires exceptionnels, pauses et cr√©neaux de livraison
</Note>

#### Exceptions (Jours f√©ri√©s, fermetures)

```bash
# Cr√©er une exception (fermeture, horaires modifi√©s)
POST /api/food/restaurants/{restaurant_id}/schedule/exceptions
# Body: {"exception_date": "2025-12-25", "exception_type": "CLOSED", "reason": "No√´l"}

# Lister les exceptions
GET /api/food/restaurants/{restaurant_id}/schedule/exceptions

# Supprimer une exception
DELETE /api/food/restaurants/{restaurant_id}/schedule/exceptions/{exception_id}
```

Types d'exception: `CLOSED`, `MODIFIED`, `SPECIAL`

#### Pauses journali√®res

```bash
# Cr√©er une pause (ex: ferm√© de 14h √† 18h)
POST /api/food/restaurants/{restaurant_id}/schedule/breaks
# Body: {"day_of_week": 0, "break_start": "14:00", "break_end": "18:00"}

# Lister les pauses
GET /api/food/restaurants/{restaurant_id}/schedule/breaks

# Supprimer une pause
DELETE /api/food/restaurants/{restaurant_id}/schedule/breaks/{break_id}
```

`day_of_week`: 0=Lundi, 1=Mardi, ..., 6=Dimanche

#### Cr√©neaux de livraison/retrait

```bash
# Cr√©er un cr√©neau
POST /api/food/restaurants/{restaurant_id}/schedule/slots
# Body: {"day_of_week": 0, "slot_start": "11:00", "slot_end": "14:00", "slot_type": "BOTH", "max_orders_per_slot": 20}

# Lister les cr√©neaux
GET /api/food/restaurants/{restaurant_id}/schedule/slots

# Supprimer un cr√©neau
DELETE /api/food/restaurants/{restaurant_id}/schedule/slots/{slot_id}
```

Types: `DELIVERY`, `PICKUP`, `BOTH`

#### V√©rifier la disponibilit√©

```bash
# V√©rifier si le restaurant est ouvert maintenant
GET /api/food/restaurants/{restaurant_id}/schedule/availability
```

---

### üçΩÔ∏è Menus Programm√©s

<Note>
  **Nouveau !** Gestion des menus du jour, menus semaine et disponibilit√© des plats
</Note>

#### Menus

```bash
# Cr√©er un menu programm√©
POST /api/food/restaurants/{restaurant_id}/menus
# Body: {"name": "Menu du Midi", "menu_type": "WEEKLY", "day_of_week": 0, "available_from": "11:00", "available_until": "14:00", "fixed_price": 5000}

# Lister tous les menus
GET /api/food/restaurants/{restaurant_id}/menus

# Menus actifs aujourd'hui
GET /api/food/restaurants/{restaurant_id}/menus/today

# R√©cup√©rer un menu
GET /api/food/restaurants/{restaurant_id}/menus/{menu_id}

# Modifier un menu
PUT /api/food/restaurants/{restaurant_id}/menus/{menu_id}

# Supprimer un menu
DELETE /api/food/restaurants/{restaurant_id}/menus/{menu_id}
```

Types de menu: `DAILY`, `WEEKLY`, `SPECIAL`, `SEASONAL`

#### Items du menu

```bash
# Ajouter un plat au menu
POST /api/food/restaurants/{restaurant_id}/menus/{menu_id}/items
# Body: {"dish_id": "uuid", "special_price": 3500, "max_quantity": 50}

# Retirer un plat du menu
DELETE /api/food/restaurants/{restaurant_id}/menus/{menu_id}/items/{item_id}
```

#### Disponibilit√© des plats par cr√©neau

```bash
# D√©finir la disponibilit√© d'un plat
POST /api/food/dishes/{dish_id}/availability
# Body: {"day_of_week": 0, "available_from": "11:00", "available_until": "14:00"}

# R√©cup√©rer la disponibilit√©
GET /api/food/dishes/{dish_id}/availability

# V√©rifier si disponible maintenant
GET /api/food/dishes/{dish_id}/available-now
```

---

## üì± Notifications Temps R√©el (Pulse)

Le module Food envoie des notifications via Pulse pour:

| √âv√©nement | Topic | Destinataire |
|-----------|-------|--------------|
| Nouvelle commande | `food.orders` | Restaurant |
| Changement statut commande | `food.orders` | Client |
| Commande annul√©e | `food.orders` | Client |
| Livraison assign√©e | `food.deliveries` | Livreur |
| Restaurant activ√© | `food.admin` | Propri√©taire |
| Restaurant suspendu | `food.admin` | Propri√©taire |
| Restaurant r√©activ√© | `food.admin` | Propri√©taire |
| Stock bas | `food.stock` | Restaurant |
| Rupture de stock | `food.stock` | Restaurant |
| Employ√© ajout√© | `food.employees` | Employ√© |

Pour recevoir les notifications, connectez-vous via:
- WebSocket: `ws://host/pulse/ws`
- SSE: `GET /pulse/sse/notifications`
